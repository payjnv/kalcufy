generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id            String              @id @default(cuid())
  email         String              @unique
  name          String?
  password      String?
  image         String?
  emailVerified DateTime?
  isPro         Boolean             @default(false)
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt
  role          String              @default("USER")
  accounts      Account[]
  history       CalculatorHistory[]
  favorites     Favorite[]
  Post          Post[]
  sessions      Session[]
  subscription  Subscription?

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Subscription {
  id                   String    @id @default(cuid())
  userId               String    @unique
  stripeCustomerId     String?   @unique
  stripeSubscriptionId String?   @unique
  stripePriceId        String?
  status               String    @default("INACTIVE")
  plan                 String    @default("FREE")
  currentPeriodStart   DateTime?
  currentPeriodEnd     DateTime?
  cancelAtPeriodEnd    Boolean   @default(false)
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  user                 User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}

model Favorite {
  id             String   @id @default(cuid())
  userId         String
  calculatorSlug String
  calculatorName String
  category       String
  createdAt      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, calculatorSlug])
  @@map("favorites")
}

model CalculatorHistory {
  id             String   @id @default(cuid())
  userId         String
  calculatorSlug String
  calculatorName String
  inputs         Json
  results        Json
  note           String?
  createdAt      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, calculatorSlug])
  @@map("calculator_history")
}

model Newsletter {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  language  String   @default("en")
  isActive  Boolean  @default(true)
  source    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("newsletter")
}

model CalculatorUsage {
  id             String       @id @default(cuid())
  calculatorSlug String
  sessionId      String?
  userId         String?
  language       String       @default("en")
  country        String?
  device         String?
  createdAt      DateTime     @default(now())
  type           TrackingType @default(VIEW)

  @@index([calculatorSlug])
  @@index([createdAt])
  @@map("calculator_usage")
}

model ContactMessage {
  id        String   @id @default(cuid())
  name      String
  email     String
  subject   String?
  message   String
  read      Boolean  @default(false)
  replied   Boolean  @default(false)
  createdAt DateTime @default(now())

  @@map("contact_messages")
}

model Post {
  id                String        @id @default(cuid())
  slugEn            String        @unique
  slugEs            String?       @unique
  slugPt            String?       @unique
  titleEn           String
  titleEs           String?
  titlePt           String?
  excerptEn         String?
  excerptEs         String?
  excerptPt         String?
  contentEn         String
  contentEs         String?
  contentPt         String?
  metaTitleEn       String?
  metaTitleEs       String?
  metaTitlePt       String?
  metaDescriptionEn String?
  metaDescriptionEs String?
  metaDescriptionPt String?
  featuredImage     String?
  ogImage           String?
  tags              String[]
  relatedCalculator String?
  status            PostStatus    @default(DRAFT)
  publishedAt       DateTime?
  scheduledAt       DateTime?
  views             Int           @default(0)
  readingTime       Int           @default(5)
  authorId          String?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  categoryId        String?
  author            User?         @relation(fields: [authorId], references: [id])
  category          BlogCategory? @relation("PostToCategory", fields: [categoryId], references: [id])

  @@index([status, publishedAt])
  @@index([categoryId])
  @@index([authorId])
  @@map("posts")
}

model AdSlot {
  id        String   @id @default(cuid())
  name      String   @unique
  location  String
  adCode    String?
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("ad_slots")
}

model BlogCategory {
  id        String   @id @default(cuid())
  slug      String   @unique
  nameEn    String
  nameEs    String?
  namePt    String?
  icon      String?
  color     String   @default("blue")
  isActive  Boolean  @default(true)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  posts     Post[]   @relation("PostToCategory")

  @@map("blog_categories")
}

enum PostStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
  ARCHIVED
}

enum TrackingType {
  VIEW
  CALCULATION
}

model CalculatorStatus {
  id        String   @id @default(cuid())
  slug      String   @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("calculator_status")
}
